
<!DOCTYPE html>
<html>
  <head>
    <title>A century in Beijing</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!--
    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <script src="js/leaflet-providers.js"></script>
    <script src="js/leaflet.ajax.min.js"></script>

  </head>

  <body style="background-color: black;">
    <div id="top" style="width: 100%; height: 70px; margin-botton=-25px;"></div>
    <div id="map-container" style="width: 99%;">
      <div id="mapid" style="width: 100%; height: 600px;"></div>
    </div>

    <script>
      // centering on Beijing old town
      var mymap = L.map('mapid').setView([39.91, 116.39], 14);
      // applying theme
      L.tileLayer.provider('Thunderforest.Pioneer', {apikey: '97aee903a5d243fa8b38476ea30c271c'}).addTo(mymap);

      // old map overlay
      var imgBounds = [ [39.94909, 116.3428], [39.8678, 116.4391] ]
      var cut = L.imageOverlay('img/map.png', imgBounds).addTo(mymap);
      //mymap.fitBounds(imgBounds);
      cut.id = 'cut';

      // old map overlay
      var imgBounds = [ [39.94909, 116.3428], [39.8678, 116.4391] ]
      var full = L.imageOverlay('img/map.jpg', imgBounds).addTo(mymap);
      full.id = 'full';

      let myRequest =
        new Request("https://raw.githubusercontent.com/sherstiuk/beijing/master/data/buildings.geojson");
      var geo;

      var myIcon = L.divIcon({ popupAnchor: [0, -30] });

      fetch(myRequest)//
        .then(resp => resp.json())
        .then(function(geo) {
          var geoJSON = L.geoJson(geo, {
              onEachFeature: onEachFeature,
              icon: myIcon
          });
          geoJSON.addTo(mymap);
        });

        function onEachFeature(feature, layer) {
            if (feature.properties && feature.properties.name) {
                layer.bindPopup(feature.properties.name);
            }

            var defaultStyle = {
              // color: "#FFF59D",
               weight: 0.5,
               opacity: 0.6,
               fillOpacity: 0.5
            };
            //layer.setStyle(defaultStyle);

            layer.on('mouseover', function (e) {
                this.openPopup();

                layer.setStyle(
                   style = {
                     //color: "#FFEB3B",
                     weight: 5,
                     opacity: 0.8,
                     fillOpacity: 0.1,
                     //fillColor: "#FFEB3B"
                    }
                );

                mymap.removeLayer(full);
            });

            layer.on("mouseout", function() {
               layer.setStyle(defaultStyle);
               this.closePopup();

               full.addTo(mymap);
            });

        }

        console.log(L.stamp(cut));

/*
      var reader = new FileReader();
      reader.onload = function(){
        if (reader.readyState != 2 || reader.error){
          return;
        } else {
          convertToLayer(reader.result);
        }
      }
      reader.readAsArrayBuffer("data/geodata.zip");

      function convertToLayer(buffer){
        shp(buffer).then(function(geojson){
          var layer = L.shapefile(geojson).addTo(mymap);
          console.log(layer);
        });
      }
*/

    </script>

  </body>
</html>
